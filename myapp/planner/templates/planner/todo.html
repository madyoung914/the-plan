{% extends 'base.html' %}

{% block title %}To-Do List{% endblock %}

{% block content %}

<h2>My To Do List</h2>
{% if todos %}
    {% if priority %}
    <h4>Priority:</h4>
        {% for task in priority %}
            {% if task.status == 'Done' %}
            <li><s>{{ task }}</s></li>
            <form action="{% url 'planner:to-do' %}" method="POST" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this item?');">
                {% csrf_token %}
                <input type="hidden" name="delete_task_id" value="{{ task.pk }}">
                <button type="submit">Delete</button>
            </form>

            <form action="{% url 'planner:to-do' %}" method="POST" style="display:inline;">
                {% csrf_token %}
                <input type="hidden" name="complete_task_id" value="{{ task.pk }}">
                <button type="submit">Undone?</button>
            </form>
                

            {% else %}
            <li>
                 {% if request.GET.edit_task_id == task.pk|stringformat:"s" %}
                <form method="POST" style="display:inline;">
                    {% csrf_token %}
                    <input type="hidden" name="edit_task_id" value="{{ task.pk }}">
                    <textarea name="entry" style="width: 100%;">{{ task }}</textarea>
                    <button type="submit">Update</button>
                    <a href="{% url 'planner:to-do' %}">Cancel</a>
                </form>
                {% else %}
                    {{ task }}
                    <a href="?edit_task_id={{ task.pk }}" >
                        <small>Edit</small>
                    </a>
                {% endif %}
            </li>
            <form action="{% url 'planner:to-do' %}" method="POST" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this item?');">
                {% csrf_token %}
                <input type="hidden" name="delete_task_id" value="{{ task.pk }}">
                <button type="submit">Delete</button>
            </form>

            <form action="{% url 'planner:to-do' %}" method="POST" style="display:inline;">
                {% csrf_token %}
                <input type="hidden" name="complete_task_id" value="{{ task.pk }}">
                <button type="submit">Done?</button>
            </form>

            <form action="{% url 'planner:to-do' %}" method="POST" style="display:inline;">
                {% csrf_token %}
                <input type="hidden" name="priority_task_id" value="{{ task.pk }}">
                <button type="submit">Unprioritize?</button>
            </form>
            {% endif %}
            
        {% endfor %}
    {% endif %}

    {% if nonpriority %}
    <h4>Later:</h4>
        {% for task in nonpriority %}
             {% if task.status == 'D' %}
            <li><s>{{ task }}</s></li>
            <form action="{% url 'planner:to-do' %}" method="POST" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this item?');">
                {% csrf_token %}
                <input type="hidden" name="delete_task_id" value="{{ task.pk }}">
                <button type="submit">Delete</button>
            </form>

            <form action="{% url 'planner:to-do' %}" method="POST" style="display:inline;">
                {% csrf_token %}
                <input type="hidden" name="complete_task_id" value="{{ task.pk }}">
                <button type="submit">Undone?</button>
            </form>
                

            {% else %}
            <li>
                {% if request.GET.edit_task_id == task.pk|stringformat:"s" %}
                <form method="POST" style="display:inline;">
                    {% csrf_token %}
                    <input type="hidden" name="edit_task_id" value="{{ task.pk }}">
                    <textarea name="entry" style="width: 100%;">{{ task }}</textarea>
                    <button type="submit">Update</button>
                    <a href="{% url 'planner:to-do' %}">Cancel</a>
                </form>
                {% else %}
                    {{ task }}
                    <a href="?edit_task_id={{ task.pk }}" >
                        <small>Edit</small>
                    </a>
                {% endif %}
            </li>
            <form action="{% url 'planner:to-do' %}" method="POST" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this item?');">
                {% csrf_token %}
                <input type="hidden" name="delete_task_id" value="{{ task.pk }}">
                <button type="submit">Delete</button>
            </form>

            <form action="{% url 'planner:to-do' %}" method="POST" style="display:inline;">
                {% csrf_token %}
                <input type="hidden" name="complete_task_id" value="{{ task.pk }}">
                <button type="submit">Done?</button>
            </form>

            <form action="{% url 'planner:to-do' %}" method="POST" style="display:inline;">
                {% csrf_token %}
                <input type="hidden" name="priority_task_id" value="{{ task.pk }}">
                <button type="submit">Prioritize?</button>
            </form>

            {% endif %}
        {% endfor %}
    {% endif %}
{% else %}
    <p>No tasks for today</p>
{% endif %}

<br>
<hr>
<h4>Add another to do </h4>
<hr>
<form method="POST">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit">Submit</button>
</form>

<br>
<hr>
<h2>My Tasks</h2>
<hr>

{% if pending_tasks %}
    <h4>Ongoing</h4>
    {% for task in pending_tasks %}
        <li>{{ task }}: {{ task.days_left }} days left</li>
    {% endfor %}
{% endif %}

{% if completed_tasks  %}
<h4>Completed</h4>
    {% for task in completed_tasks %}
        <li>{{ task }}: {{ task.days_left }} days left</li>
    {% endfor %}
{% endif %}

{% if missed_tasks %}
    <h4>Missed</h4>
    {% for task in missed_tasks %}
        <li>{{ task }}: {{ task.days_left }} days left</li>
    {% endfor %}
{% endif %}

{% if not pending_tasks and not completed_tasks and not missed_tasks %}
    <p>No tasks</p>
{% endif %}

<br>
<a href="{% url 'useraccounts:homepage' %}">Go back to homepage</a>
{% endblock %}